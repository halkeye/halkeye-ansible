---
- name: Update bashrc
  when: "'wsl' in group_names"
  blockinfile:
    dest: "{{ lookup('env','HOME') }}/.bashrc"
    block: |
      if [ -t 1 ]; then exec zsh;fi

- name: ensure .zshrc.local exists
  file:
    path: "{{ lookup('env','HOME') }}/.zshrc.local"
    group: "{{ lookup('env', 'USER') }}"
    owner: "{{ lookup('env', 'USER') }}"
    mode: 0700
    state: "touch"

- name: All the useful stuff for zshrc
  blockinfile:
    dest: "{{ lookup('env','HOME') }}/.zshrc.local"
    block: |
      export POWERLEVEL9K_TIME_FORMAT='%D{\%I:\%M:\%S \%p}'
      export TZ=America/Vancouver
      if [ -e "$HOME/bin" ]; then export PATH="$HOME/bin:$PATH"; fi
      if [ -e "$HOME/.local/bin" ]; then export PATH="$HOME/.local/bin:$PATH"; fi
      if [ -e "/opt/google-cloud-sdk/bin" ]; then export PATH="/opt/google-cloud-sdk/bin:$PATH"; fi
      if [ -e "/opt/apache-maven-3.3.9/bin" ]; then export PATH="/opt/apache-maven-3.3.9/bin/:$PATH"; fi
      if [ -e "$GOPATH" ]; then export PATH="$GOPATH/bin:$PATH"; fi
      if [ -e "/mnt/c/Program Files/Microsoft VS Code/bin" ]; then export PATH="$PATH:/mnt/c/Program Files/Microsoft VS Code/bin"; fi
      if [ -e "/mnt/c/Windows/System32/" ]; then export PATH="$PATH:/mnt/c/Windows/System32"; fi
      if [ -e "/mnt/c/ProgramData/chocolatey/bin" ]; then export PATH="$PATH:/mnt/c/ProgramData/chocolatey/bin"; fi
      alias ag="ag --color-path 35 --color-match '1;35' --color-line-number 32"
      alias webbie="python -m SimpleHTTPServer"
      alias ncu="docker run -it --rm -v $(pwd)/package.json:/app/package.json creack/ncu"
      eval `dircolors $HOME/.antigen/bundles/joel-porquet/zsh-dircolors-solarized/dircolors-solarized/dircolors.ansi-dark`
      alias tmux && unalias tmux

- name: Make sure wsl don't use fzf for history search
  blockinfile:
    dest: "{{ lookup('env','HOME') }}/.zshrc.local"
    marker: "# {mark} SECOND ANSIBLE MANAGED BLOCK"
    block: |
      bindkey "^R" history-incremental-search-backward
      alias ncu="npx -p npm-check-updates ncu"
      alias docker='/mnt/c/ProgramData/chocolatey/bin/docker.exe'
  when: "'wsl' in group_names"
